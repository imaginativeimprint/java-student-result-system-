import java.util.*;
import java.text.DecimalFormat;

// Student class
class Student {
    private String usn;
    private String name;
    private String dob;
    private Map<Integer, Semester> semesters;
    
    public Student(String usn, String name, String dob) {
        this.usn = usn;
        this.name = name;
        this.dob = dob;
        this.semesters = new HashMap<>();
    }
    
    // Getters and setters
    public String getUsn() { return usn; }
    public String getName() { return name; }
    public String getDob() { return dob; }
    public Map<Integer, Semester> getSemesters() { return semesters; }
    
    public void addSemester(int semNumber, Semester semester) {
        semesters.put(semNumber, semester);
    }
    
    public void removeSemester(int semNumber) {
        semesters.remove(semNumber);
    }
    
    public boolean hasMarksInSemester(int semNumber) {
        Semester sem = semesters.get(semNumber);
        if (sem == null) return false;
        
        for (Subject subject : sem.getSubjects()) {
            if (subject.getMarks() != -1) {
                return true;
            }
        }
        return false;
    }
    
    public boolean hasFailedInAnySubject(int semNumber) {
        Semester sem = semesters.get(semNumber);
        if (sem == null) return false;
        
        for (Subject subject : sem.getSubjects()) {
            if (subject.hasMarks() && subject.getMarks() < 40) {
                return true;
            }
        }
        return false;
    }
    
    public boolean isPreviousSemesterCompleted(int currentSem) {
        // Check if all previous semesters are completed
        for (int sem = 1; sem < currentSem; sem++) {
            Semester semester = semesters.get(sem);
            if (semester == null || !semester.allSubjectsHaveMarks()) {
                return false;
            }
        }
        return true;
    }
    
    public int getHighestCompletedSemester() {
        for (int sem = 8; sem >= 1; sem--) {
            Semester semester = semesters.get(sem);
            if (semester != null && semester.allSubjectsHaveMarks()) {
                return sem;
            }
        }
        return 0;
    }
}

// Subject class
class Subject {
    private String code;
    private String name;
    private int credits;
    private int marks;
    
    public Subject(String code, String name, int credits) {
        this.code = code;
        this.name = name;
        this.credits = credits;
        this.marks = -1; // -1 indicates marks not entered yet
    }
    
    // Getters and setters
    public String getCode() { return code; }
    public String getName() { return name; }
    public int getCredits() { return credits; }
    public int getMarks() { return marks; }
    
    public void setMarks(int marks) {
        this.marks = marks;
    }
    
    public boolean isPass() {
        return marks >= 40;
    }
    
    public String getGrade() {
        if (marks == -1) return "N/A";
        if (marks < 40) return "F";
        else if (marks >= 90) return "S";
        else if (marks >= 80) return "A";
        else if (marks >= 70) return "B";
        else if (marks >= 60) return "C";
        else if (marks >= 50) return "D";
        else return "E";
    }
    
    public double getGradePoints() {
        if (marks < 40) return 0.0; // Fail
        else if (marks >= 90) return 10.0;
        else if (marks >= 80) return 9.0;
        else if (marks >= 70) return 8.0;
        else if (marks >= 60) return 7.0;
        else if (marks >= 50) return 6.0;
        else if (marks >= 40) return 5.0;
        else return 0.0;
    }
    
    public boolean hasMarks() {
        return marks != -1;
    }
}

// Semester class
class Semester {
    private int semNumber;
    private List<Subject> subjects;
    
    public Semester(int semNumber) {
        this.semNumber = semNumber;
        this.subjects = new ArrayList<>();
        initializeDefaultSubjects();
    }
    
    private void initializeDefaultSubjects() {
        // Pre-add 5 subjects for each semester
        switch(semNumber) {
            case 1:
                subjects.add(new Subject("M101", "Mathematics-I", 4));
                subjects.add(new Subject("P101", "Physics", 4));
                subjects.add(new Subject("C101", "Chemistry", 3));
                subjects.add(new Subject("E101", "Electrical Engineering", 3));
                subjects.add(new Subject("ME101", "Mechanical Engineering", 3));
                break;
            case 2:
                subjects.add(new Subject("M102", "Mathematics-II", 4));
                subjects.add(new Subject("P102", "Advanced Physics", 4));
                subjects.add(new Subject("C102", "Advanced Chemistry", 3));
                subjects.add(new Subject("CS101", "Computer Science", 3));
                subjects.add(new Subject("CE101", "Civil Engineering", 3));
                break;
            case 3:
                subjects.add(new Subject("DSA", "Data Structures", 4));
                subjects.add(new Subject("OOP", "Object Oriented Programming", 4));
                subjects.add(new Subject("DBMS", "Database Management", 3));
                subjects.add(new Subject("OS", "Operating Systems", 3));
                subjects.add(new Subject("DM", "Discrete Mathematics", 3));
                break;
            case 4:
                subjects.add(new Subject("ALGO", "Algorithms", 4));
                subjects.add(new Subject("CN", "Computer Networks", 4));
                subjects.add(new Subject("SE", "Software Engineering", 3));
                subjects.add(new Subject("TOC", "Theory of Computation", 3));
                subjects.add(new Subject("MP", "Microprocessors", 3));
                break;
            case 5:
                subjects.add(new Subject("AI", "Artificial Intelligence", 4));
                subjects.add(new Subject("ML", "Machine Learning", 4));
                subjects.add(new Subject("WT", "Web Technologies", 3));
                subjects.add(new Subject("CG", "Computer Graphics", 3));
                subjects.add(new Subject("DAA", "Design Analysis of Algorithms", 3));
                break;
            case 6:
                subjects.add(new Subject("BD", "Big Data", 4));
                subjects.add(new Subject("CC", "Cloud Computing", 4));
                subjects.add(new Subject("IOT", "Internet of Things", 3));
                subjects.add(new Subject("IS", "Information Security", 3));
                subjects.add(new Subject("CD", "Compiler Design", 3));
                break;
            case 7:
                subjects.add(new Subject("DS", "Data Science", 4));
                subjects.add(new Subject("NLP", "Natural Language Processing", 4));
                subjects.add(new Subject("BC", "Blockchain", 3));
                subjects.add(new Subject("ARVR", "AR/VR Technologies", 3));
                subjects.add(new Subject("ES", "Embedded Systems", 3));
                break;
            case 8:
                subjects.add(new Subject("PM", "Project Management", 4));
                subjects.add(new Subject("ESD", "Enterprise System Design", 4));
                subjects.add(new Subject("QA", "Quality Assurance", 3));
                subjects.add(new Subject("IPR", "IPR and Patents", 3));
                subjects.add(new Subject("PP", "Professional Practice", 3));
                break;
        }
    }
    
    // Getters
    public int getSemNumber() { return semNumber; }
    public List<Subject> getSubjects() { return subjects; }
    
    public void addSubject(Subject subject) {
        subjects.add(subject);
    }
    
    public void removeSubject(String subjectCode) {
        subjects.removeIf(subject -> subject.getCode().equals(subjectCode));
    }
    
    public boolean hasAnyMarks() {
        for (Subject subject : subjects) {
            if (subject.hasMarks()) {
                return true;
            }
        }
        return false;
    }
    
    public boolean allSubjectsHaveMarks() {
        for (Subject subject : subjects) {
            if (!subject.hasMarks()) {
                return false;
            }
        }
        return true;
    }
    
    public boolean hasFailedSubjects() {
        for (Subject subject : subjects) {
            if (subject.hasMarks() && !subject.isPass()) {
                return true;
            }
        }
        return false;
    }
    
    public int getFailedSubjectCount() {
        int count = 0;
        for (Subject subject : subjects) {
            if (subject.hasMarks() && !subject.isPass()) {
                count++;
            }
        }
        return count;
    }
    
    public double calculateSGPA() {
        double totalCredits = 0;
        double totalGradePoints = 0;
        boolean hasAnyMarks = false;
        
        for (Subject subject : subjects) {
            if (subject.hasMarks()) {
                totalCredits += subject.getCredits();
                totalGradePoints += subject.getGradePoints() * subject.getCredits();
                hasAnyMarks = true;
            }
        }
        
        return hasAnyMarks ? (totalCredits == 0 ? 0 : totalGradePoints / totalCredits) : 0;
    }
    
    public boolean isPass() {
        return !hasFailedSubjects();
    }
}

// Result Management System class
class ResultManagementSystem {
    private Map<String, Student> students;
    private static final String ADMIN_PASSWORD = "admin123";
    private Scanner scanner;
    private DecimalFormat df;
    
    public ResultManagementSystem() {
        this.students = new HashMap<>();
        this.scanner = new Scanner(System.in);
        this.df = new DecimalFormat("#.##");
        initializePreAddedStudents();
    }
    
    private void initializePreAddedStudents() {
        // Pre-add students
        addPreAddedStudent("172", "Shashank", "15-06-1999");
        addPreAddedStudent("131", "Priti Ranjan", "20-08-1999");
        addPreAddedStudent("147", "Rajeev", "10-12-1998");
        addPreAddedStudent("137", "Rahul", "05-03-1999");
    }
    
    private void addPreAddedStudent(String usn, String name, String dob) {
        Student student = new Student(usn, name, dob);
        students.put(usn, student);
    }
    
    public void start() {
        while (true) {
            System.out.println("\n===== STUDENT RESULT MANAGEMENT SYSTEM =====");
            System.out.println("1. Student Login");
            System.out.println("2. Management Login");
            System.out.println("3. Exit");
            System.out.print("Enter your choice: ");
            
            int choice = getIntInput();
            
            switch (choice) {
                case 1:
                    studentLogin();
                    break;
                case 2:
                    managementLogin();
                    break;
                case 3:
                    System.out.println("Thank you for using the system!");
                    return;
                default:
                    System.out.println("Invalid choice! Please try again.");
            }
        }
    }
    
    private void studentLogin() {
        System.out.println("\n----- STUDENT LOGIN -----");
        System.out.print("Enter USN: ");
        String usn = scanner.nextLine();
        System.out.print("Enter Date of Birth (DD-MM-YYYY): ");
        String dob = scanner.nextLine();
        
        Student student = students.get(usn);
        if (student != null && student.getDob().equals(dob)) {
            viewStudentResult(student);
        } else {
            System.out.println("Invalid USN or Date of Birth!");
        }
    }
    
    private void viewStudentResult(Student student) {
        System.out.println("\n----- STUDENT RESULT -----");
        System.out.println("Name: " + student.getName());
        System.out.println("USN: " + student.getUsn());
        System.out.println("DOB: " + student.getDob());
        
        if (student.getSemesters().isEmpty()) {
            System.out.println("No semester data available!");
            return;
        }
        
        System.out.println("\nAvailable Semesters: " + student.getSemesters().keySet());
        System.out.print("Enter semester number to view result (or 'all' for all semesters): ");
        String input = scanner.nextLine();
        
        if (input.equalsIgnoreCase("all")) {
            displayAllSemestersResult(student);
        } else {
            try {
                int sem = Integer.parseInt(input);
                displaySemesterResult(student, sem);
            } catch (NumberFormatException e) {
                System.out.println("Invalid semester number!");
            }
        }
    }
    
    private void displaySemesterResult(Student student, int semNumber) {
        Semester semester = student.getSemesters().get(semNumber);
        if (semester == null) {
            System.out.println("No data available for semester " + semNumber);
            return;
        }
        
        System.out.println("\n===== SEMESTER " + semNumber + " RESULT =====");
        System.out.printf("%-10s %-25s %-8s %-6s %-8s %-10s\n", 
            "Code", "Subject Name", "Credits", "Marks", "Grade", "Status");
        System.out.println("-------------------------------------------------------------------");
        
        boolean hasAnyMarks = false;
        for (Subject subject : semester.getSubjects()) {
            String marksStr = subject.getMarks() == -1 ? "N/A" : String.valueOf(subject.getMarks());
            String gradeStr = subject.getGrade();
            String status = "N/A";
            
            if (subject.hasMarks()) {
                status = subject.isPass() ? "PASS" : "FAIL";
                hasAnyMarks = true;
            }
            
            System.out.printf("%-10s %-25s %-8d %-6s %-8s %-10s\n", 
                subject.getCode(), subject.getName(), subject.getCredits(), 
                marksStr, gradeStr, status);
        }
        
        if (hasAnyMarks) {
            double sgpa = semester.calculateSGPA();
            System.out.println("\nSGPA: " + df.format(sgpa));
            
            // Check if student has failed in any subject
            if (semester.hasFailedSubjects()) {
                int failedCount = semester.getFailedSubjectCount();
                System.out.println("❌ RESULT: FAIL (" + failedCount + " subject(s) failed)");
                System.out.println("⚠️  Student must clear the failed subject(s) to pass this semester");
            } else if (semester.allSubjectsHaveMarks()) {
                System.out.println("✅ RESULT: PASS");
            } else {
                System.out.println("⏳ RESULT: Incomplete (some marks pending)");
            }
            
            // Calculate CGPA for completed semesters only
            double cgpa = calculateCGPA(student);
            System.out.println("CGPA (Completed Semesters): " + df.format(cgpa));
        } else {
            System.out.println("\nNo marks entered for this semester!");
        }
    }
    
    private void displayAllSemestersResult(Student student) {
        double totalCGPA = 0;
        int semCount = 0;
        
        System.out.println("\n===== ALL SEMESTERS RESULT =====");
        for (int sem = 1; sem <= 8; sem++) {
            Semester semester = student.getSemesters().get(sem);
            if (semester != null && semester.hasAnyMarks()) {
                double sgpa = semester.calculateSGPA();
                if (sgpa > 0) {
                    totalCGPA += sgpa;
                    semCount++;
                    
                    String resultStatus = "Incomplete";
                    if (semester.allSubjectsHaveMarks()) {
                        resultStatus = semester.isPass() ? "PASS" : "FAIL";
                    }
                    
                    System.out.println("Semester " + sem + " - SGPA: " + df.format(sgpa) + 
                                      " - Status: " + resultStatus);
                    
                    if (semester.hasFailedSubjects()) {
                        System.out.println("  Failed in " + semester.getFailedSubjectCount() + " subject(s)");
                    }
                }
            }
        }
        
        if (semCount > 0) {
            System.out.println("Overall CGPA (Completed Semesters): " + df.format(totalCGPA / semCount));
        } else {
            System.out.println("No semester data with marks available!");
        }
    }
    
    private double calculateCGPA(Student student) {
        double totalSGPA = 0;
        int count = 0;
        
        // Calculate CGPA only for completed semesters (all subjects have marks)
        for (int sem = 1; sem <= 8; sem++) {
            Semester semester = student.getSemesters().get(sem);
            if (semester != null && semester.allSubjectsHaveMarks() && semester.isPass()) {
                double sgpa = semester.calculateSGPA();
                totalSGPA += sgpa;
                count++;
            }
        }
        
        return count == 0 ? 0 : totalSGPA / count;
    }
    
    private void managementLogin() {
        System.out.print("\nEnter Admin Password: ");
        String password = scanner.nextLine();
        
        if (!password.equals(ADMIN_PASSWORD)) {
            System.out.println("Invalid password!");
            return;
        }
        
        managementMenu();
    }
    
    private void managementMenu() {
        while (true) {
            System.out.println("\n----- MANAGEMENT MENU -----");
            System.out.println("1. Add Student");
            System.out.println("2. Delete Student");
            System.out.println("3. Add/Update Student Marks");
            System.out.println("4. View All Students");
            System.out.println("5. Add Subject to Semester");
            System.out.println("6. Delete Subject from Semester");
            System.out.println("7. View Student Result");
            System.out.println("8. Back to Main Menu");
            System.out.print("Enter your choice: ");
            
            int choice = getIntInput();
            
            switch (choice) {
                case 1:
                    addStudent();
                    break;
                case 2:
                    deleteStudent();
                    break;
                case 3:
                    addUpdateMarks();
                    break;
                case 4:
                    viewAllStudents();
                    break;
                case 5:
                    addSubjectToSemester();
                    break;
                case 6:
                    deleteSubjectFromSemester();
                    break;
                case 7:
                    viewStudentResultManagement();
                    break;
                case 8:
                    return;
                default:
                    System.out.println("Invalid choice! Please try again.");
            }
        }
    }
    
    private void addStudent() {
        System.out.println("\n----- ADD STUDENT -----");
        System.out.print("Enter USN: ");
        String usn = scanner.nextLine();
        
        if (students.containsKey(usn)) {
            System.out.println("Student with USN " + usn + " already exists!");
            return;
        }
        
        System.out.print("Enter Name: ");
        String name = scanner.nextLine();
        System.out.print("Enter Date of Birth (DD-MM-YYYY): ");
        String dob = scanner.nextLine();
        
        Student student = new Student(usn, name, dob);
        students.put(usn, student);
        System.out.println("Student added successfully!");
    }
    
    private void deleteStudent() {
        System.out.println("\n----- DELETE STUDENT -----");
        System.out.print("Enter Student USN to delete: ");
        String usn = scanner.nextLine();
        
        if (!students.containsKey(usn)) {
            System.out.println("Student with USN " + usn + " not found!");
            return;
        }
        
        System.out.print("Confirm deletion of " + students.get(usn).getName() + "? (yes/no): ");
        String confirmation = scanner.nextLine();
        
        if (confirmation.equalsIgnoreCase("yes")) {
            students.remove(usn);
            System.out.println("Student deleted successfully!");
        } else {
            System.out.println("Deletion cancelled.");
        }
    }
    
    private void addUpdateMarks() {
        System.out.println("\n----- ADD/UPDATE MARKS -----");
        System.out.print("Enter Student USN: ");
        String usn = scanner.nextLine();
        
        Student student = students.get(usn);
        if (student == null) {
            System.out.println("Student not found!");
            return;
        }
        
        System.out.print("Enter Semester Number (1-8): ");
        int sem = getIntInput();
        
        if (sem < 1 || sem > 8) {
            System.out.println("Invalid semester number!");
            return;
        }
        
        // Validate previous semesters completion
        if (sem > 1) {
            int highestCompleted = student.getHighestCompletedSemester();
            if (highestCompleted < sem - 1) {
                System.out.println("❌ ERROR: Cannot add marks for Semester " + sem);
                System.out.println("Student must complete Semester " + (sem - 1) + " first.");
                System.out.println("Currently completed up to Semester: " + 
                    (highestCompleted == 0 ? "None" : highestCompleted));
                return;
            }
        }
        
        Semester semester = student.getSemesters().get(sem);
        if (semester == null) {
            semester = new Semester(sem);
            student.addSemester(sem, semester);
        }
        
        // Check if no marks are entered in any subject
        boolean noMarksEntered = !semester.hasAnyMarks();
        
        if (noMarksEntered) {
            System.out.println("\nNo marks entered for any subject in Semester " + sem);
            System.out.print("Would you like to enter marks for all subjects? (yes/no): ");
            String choice = scanner.nextLine();
            
            if (choice.equalsIgnoreCase("yes")) {
                enterAllMarksForSemester(semester, sem);
                return;
            }
        }
        
        // Show individual subject selection
        System.out.println("\nSubjects in Semester " + sem + ":");
        List<Subject> subjects = semester.getSubjects();
        for (int i = 0; i < subjects.size(); i++) {
            Subject subject = subjects.get(i);
            String marksInfo = subject.getMarks() == -1 ? "Not entered" : "Marks: " + subject.getMarks();
            String status = subject.hasMarks() ? (subject.isPass() ? "PASS" : "FAIL") : "N/A";
            System.out.println((i + 1) + ". " + subject.getCode() + " - " + 
                subject.getName() + " (" + subject.getCredits() + " credits) - " + 
                marksInfo + " - " + status);
        }
        
        System.out.print("Enter subject number to update marks: ");
        int subjectChoice = getIntInput();
        
        if (subjectChoice < 1 || subjectChoice > subjects.size()) {
            System.out.println("Invalid subject number!");
            return;
        }
        
        Subject selectedSubject = subjects.get(subjectChoice - 1);
        
        if (selectedSubject.getMarks() != -1) {
            System.out.print("Marks already exist (" + selectedSubject.getMarks() + 
                " - " + (selectedSubject.isPass() ? "PASS" : "FAIL") + 
                "). Do you want to update? (yes/no): ");
            String update = scanner.nextLine();
            if (!update.equalsIgnoreCase("yes")) {
                System.out.println("Update cancelled.");
                return;
            }
        }
        
        System.out.print("Enter marks for " + selectedSubject.getName() + " (0-100): ");
        int marks = getIntInput();
        
        if (marks < 0 || marks > 100) {
            System.out.println("Invalid marks! Should be between 0 and 100.");
            return;
        }
        
        selectedSubject.setMarks(marks);
        
        // Show pass/fail status
        if (marks < 40) {
            System.out.println("❌ Marks entered: " + marks + " - STATUS: FAIL");
        } else {
            System.out.println("✅ Marks entered: " + marks + " - STATUS: PASS");
        }
        
        System.out.println("Marks updated successfully!");
        
        // Calculate and display SGPA if any marks exist
        if (semester.hasAnyMarks()) {
            double sgpa = semester.calculateSGPA();
            System.out.println("Updated SGPA for Semester " + sem + ": " + df.format(sgpa));
            
            // Check and display fail status
            if (semester.hasFailedSubjects()) {
                System.out.println("⚠️  Student has failed in " + semester.getFailedSubjectCount() + " subject(s)");
            }
            
            // Calculate and display CGPA for completed semesters
            double cgpa = calculateCGPA(student);
            System.out.println("Current CGPA (Completed Semesters): " + df.format(cgpa));
        }
    }
    
    private void enterAllMarksForSemester(Semester semester, int semNumber) {
        System.out.println("\n----- ENTERING MARKS FOR ALL SUBJECTS - SEMESTER " + semNumber + " -----");
        List<Subject> subjects = semester.getSubjects();
        int failCount = 0;
        
        for (int i = 0; i < subjects.size(); i++) {
            Subject subject = subjects.get(i);
            System.out.print("Enter marks for " + subject.getName() + " (" + subject.getCode() + 
                ", " + subject.getCredits() + " credits): ");
            int marks = getIntInput();
            
            if (marks < 0 || marks > 100) {
                System.out.println("Invalid marks! Using 0 as default.");
                marks = 0;
            }
            
            subject.setMarks(marks);
            
            if (marks < 40) {
                System.out.println("   FAIL");
                failCount++;
            } else {
                System.out.println("   PASS");
            }
        }
        
        System.out.println("\nAll marks entered successfully!");
        
        // Calculate and display SGPA
        double sgpa = semester.calculateSGPA();
        System.out.println("SGPA for Semester " + semNumber + ": " + df.format(sgpa));
        
        // Display final result
        if (failCount > 0) {
            System.out.println("❌ FINAL RESULT: FAIL (" + failCount + " subject(s) failed)");
        } else {
            System.out.println("✅ FINAL RESULT: PASS");
        }
    }
    
    private void viewAllStudents() {
        System.out.println("\n----- VIEW STUDENTS -----");
        System.out.println("1. View All Students");
        System.out.println("2. View Students by Semester");
        System.out.print("Enter your choice: ");
        
        int choice = getIntInput();
        
        switch (choice) {
            case 1:
                displayAllStudents();
                break;
            case 2:
                viewStudentsBySemester();
                break;
            default:
                System.out.println("Invalid choice!");
                return;
        }
    }
    
    private void displayAllStudents() {
        System.out.println("\n----- ALL STUDENTS -----");
        if (students.isEmpty()) {
            System.out.println("No students found!");
            return;
        }
        
        System.out.printf("%-10s %-20s %-12s %-15s %-10s\n", "USN", "Name", "DOB", "Completed Sems", "Status");
        System.out.println("----------------------------------------------------------------");
        
        for (Student student : students.values()) {
            int completedSems = countCompletedSemesters(student);
            String overallStatus = getOverallStatus(student);
            System.out.printf("%-10s %-20s %-12s %-15d %-10s\n", 
                student.getUsn(), student.getName(), student.getDob(), completedSems, overallStatus);
        }
        
        viewStudentDetailsOption();
    }
    
    private void viewStudentsBySemester() {
        System.out.print("\nEnter Semester Number (1-8): ");
        int sem = getIntInput();
        
        if (sem < 1 || sem > 8) {
            System.out.println("Invalid semester number!");
            return;
        }
        
        System.out.println("\n----- STUDENTS IN SEMESTER " + sem + " -----");
        System.out.printf("%-10s %-20s %-12s %-15s\n", "USN", "Name", "DOB", "Status");
        System.out.println("-----------------------------------------------------");
        
        boolean found = false;
        for (Student student : students.values()) {
            Semester semester = student.getSemesters().get(sem);
            if (semester != null) {
                found = true;
                String status = "No Data";
                if (semester.allSubjectsHaveMarks()) {
                    status = semester.isPass() ?  "PASS" : "FAIL";
                } else if (semester.hasAnyMarks()) {
                    status = "In Progress";
                }
                
                System.out.printf("%-10s %-20s %-12s %-15s\n", 
                    student.getUsn(), student.getName(), student.getDob(), status);
            }
        }
        
        if (!found) {
            System.out.println("No students found with data for Semester " + sem);
            return;
        }
        
        viewStudentDetailsOption();
    }
    
    private void viewStudentDetailsOption() {
        System.out.print("\nView specific student details? (yes/no): ");
        String viewDetails = scanner.nextLine();
        
        if (viewDetails.equalsIgnoreCase("yes")) {
            System.out.print("Enter USN: ");
            String usn = scanner.nextLine();
            Student student = students.get(usn);
            if (student != null) {
                System.out.print("View specific semester or all? (specific/all): ");
                String choice = scanner.nextLine();
                if (choice.equalsIgnoreCase("specific")) {
                    System.out.print("Enter semester number: ");
                    int sem = getIntInput();
                    displaySemesterResult(student, sem);
                } else {
                    displayAllSemestersResult(student);
                }
            } else {
                System.out.println("Student not found!");
            }
        }
    }
    
    private int countCompletedSemesters(Student student) {
        int count = 0;
        for (int sem = 1; sem <= 8; sem++) {
            Semester semester = student.getSemesters().get(sem);
            if (semester != null && semester.allSubjectsHaveMarks()) {
                count++;
            }
        }
        return count;
    }
    
    private String getOverallStatus(Student student) {
        boolean hasFailures = false;
        boolean allCompleted = true;
        
        for (int sem = 1; sem <= 8; sem++) {
            Semester semester = student.getSemesters().get(sem);
            if (semester != null) {
                if (semester.allSubjectsHaveMarks()) {
                    if (semester.hasFailedSubjects()) {
                        hasFailures = true;
                    }
                } else if (semester.hasAnyMarks()) {
                    allCompleted = false;
                }
            }
        }
        
        if (hasFailures) return "FAIL";
        if (allCompleted) return "PASS";
        return "IN PROGRESS";
    }
    
    private void addSubjectToSemester() {
        System.out.println("\n----- ADD SUBJECT TO SEMESTER -----");
        System.out.print("Enter Semester Number (1-8): ");
        int sem = getIntInput();
        
        if (sem < 1 || sem > 8) {
            System.out.println("Invalid semester number!");
            return;
        }
        
        System.out.print("Enter Subject Code: ");
        String code = scanner.nextLine();
        System.out.print("Enter Subject Name: ");
        String name = scanner.nextLine();
        System.out.print("Enter Credits: ");
        int credits = getIntInput();
        
        // Add this subject to all students for this semester
        int count = 0;
        for (Student student : students.values()) {
            Semester semester = student.getSemesters().get(sem);
            if (semester == null) {
                semester = new Semester(sem);
                student.addSemester(sem, semester);
            }
            semester.addSubject(new Subject(code, name, credits));
            count++;
        }
        
        System.out.println("Subject added to semester " + sem + " for " + count + " students.");
    }
    
    private void deleteSubjectFromSemester() {
        System.out.println("\n----- DELETE SUBJECT FROM SEMESTER -----");
        System.out.print("Enter Semester Number (1-8): ");
        int sem = getIntInput();
        
        if (sem < 1 || sem > 8) {
            System.out.println("Invalid semester number!");
            return;
        }
        
        System.out.print("Enter Subject Code to delete: ");
        String code = scanner.nextLine();
        
        int count = 0;
        for (Student student : students.values()) {
            Semester semester = student.getSemesters().get(sem);
            if (semester != null) {
                semester.removeSubject(code);
                count++;
            }
        }
        
        System.out.println("Subject removed from semester " + sem + " for " + count + " students.");
    }
    
    private void viewStudentResultManagement() {
        System.out.print("\nEnter Student USN: ");
        String usn = scanner.nextLine();
        
        Student student = students.get(usn);
        if (student == null) {
            System.out.println("Student not found!");
            return;
        }
        
        viewStudentResult(student);
    }
    
    private int getIntInput() {
        while (true) {
            try {
                return Integer.parseInt(scanner.nextLine());
            } catch (NumberFormatException e) {
                System.out.print("Invalid input! Please enter a number: ");
            }
        }
    }
}

// Main class
public class StudentResultSystem {
    public static void main(String[] args) {
        ResultManagementSystem system = new ResultManagementSystem();
        system.start();
    }
}
